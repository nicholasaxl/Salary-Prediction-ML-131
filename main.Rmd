---
title: 'PSTAT 131 Final Project: Model comparison for predicting the salary of a data
  science job'
author: "Nicholas Axl Andrian"
date: "2023-11-23"
output:
  pdf_document: default
  html_document: default
---

Dataset used: https://www.kaggle.com/datasets/arnabchaki/data-science-salaries-2023

In this project, we will be fitting several different machine learning algorithms to find out which method of prediction is the most accurate in getting the predicted salary(in usd).

About the data set's variables (excerpt from the kaggle site)

+ work_year: The year the salary was paid.
+ experience_level: The experience level in the job during the year
+ employment_type: The type of employment for the role
+ job_title: The role worked in during the year.
+ salary: The total gross salary amount paid.
+ salary_currency: The currency of the salary paid as an ISO 4217 currency code.
+ salaryinusd: The salary in USD
+ employee_residence: Employee's primary country of residence in during the work + year as an ISO 3166 country code.
+ remote_ratio: The overall amount of work done remotely
+ company_location: The country of the employer's main office or contracting branch
+ company_size: The median number of people that worked for the company during the year

```{r setup, message=FALSE}
library(dplyr)
library(randomForest)
library(gbm)
library(ISLR)
library(tree)
library(tidyverse)
library(ggplot2)
library(gridExtra)


options("max.print" = 5) # to prevent page number bloat
```

## Part 1: Exploratory Data Analysis

Loading the dataset
```{r}
salaries <- read.csv("ds_salaries.csv")
```
Checking the structure of the dataset
```{r}
head(salaries)
str(salaries)
```
Already we can see an issue that needs to be worked on. Several variables seem to supposedly be read in as factors. We will finish conducting checks on the dataset before converting said columns.


Checking the summary of the dataset
```{r}
summary(salaries)
```
Checking for null values
```{r}
colSums(is.na(salaries))
```
Fortunately, we have no null values so imputing is not required

Checking potential factor columns for their unique values
```{r}
factor_cols <- salaries[, c(2, 3, 4, 6, 8, 10, 11)]

# finding unique values, referenced code from https://www.kaggle.com/code/abdulfaheem11/data-science-salaries-2023-analysis

# output ommitted to prevent too much space being taken up
sapply(factor_cols, function(col) unique(col))
```

Changing said variables to become factors

```{r}
salaries[, c(2, 3, 4, 6, 8, 10, 11)] <- lapply(factor_cols, factor)
str(salaries)
```
We can also drop the salary as we will just be using the salary_in_usd to simplify our steps.

```{r}
salaries <- salaries[, !(names(salaries) %in% c('salary_currency','salary'))]
```

Visualization to search for patterns with regards to the salary_in_usd

Prioritizing focus on work_year, experience_level, employment_type, job_title, employee_residence, remote_ratio, company_location, company_size

```{r}
yearplot <- ggplot(salaries, aes(x = work_year, y = salary_in_usd)) +
  geom_point(color = "red", size = 3) +
  labs(x = "Work Year", y = "Salary in USD", title = "Salary vs Work Year")

# Boxplot using ggplot
expplot <- ggplot(salaries, aes(x = experience_level, y = salary_in_usd)) +
  geom_boxplot(fill = "skyblue") +
  labs(x = "Experience Level", y = "Salary in USD", title = "Salary vs Experience Level")

grid.arrange(yearplot, expplot, ncol = 2)
```

+ We can see that the average salary in usd increases as the years go by, as the line congests further upwards towards the end.
+ Experience level does not really show much of a trend as it goes towards seniority, We can tell though that EX has the highest average and MI has the highest peak

```{r}
employplot <- ggplot(salaries, aes(x = employment_type, y = salary_in_usd)) +
  geom_boxplot(fill = "skyblue") +
  labs(x = "Employment Type", y = "Salary in USD", title = "Salary vs Employment Type")

remoteplot <- ggplot(salaries, aes(x = remote_ratio, y = salary_in_usd)) +
  geom_point(color = "red", size = 3, shape = 19) +
  labs(x = "Remote Ratio", y = "Salary in USD", title = "Salary vs Remote Ratio")

grid.arrange(employplot, remoteplot, ncol = 2)
```

+ In employment type, FT has the highest average as well as higher peaks
+ Remote ratio consists of 0, 50 and 100. The highest points as well as average are in the order 0>100>50 

```{r}
usd_salary_by_size <- salaries%>%
  group_by(company_size)%>%
  summarise(Avg_sal=mean(salary_in_usd))

sizeplot <- ggplot(usd_salary_by_size, aes(x=company_size, y=Avg_sal)) +
  geom_col() +
  labs(title='Avg Salary vs Company Size', x='Company Size', y='Average Salary in USD')

residenceplot <- ggplot(salaries, aes(x = employee_residence, y = salary_in_usd)) +
  geom_bar(stat = "summary", fun = "mean", fill = "skyblue") +
  labs(x = "Residence", y = "Mean Salary in USD", title = "Mean Salary vs Residence") + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

grid.arrange(sizeplot,residenceplot, ncol = 2)
```
+ From this plot we can also see that medium sized companies pay the largest on average, followed by large then small
+ We can see that out of all the residences, IL has the largest mean salary by a huge margin. This may be alarming so we will have to keep an eye on it as it may be an inaccurate input

Plotting job_title/employee_residence/company_location would be way too congested due to overwhelming amounts of factor levels. I have decided to just show a summary of their statistics
```{r}
title_summary <- salaries %>%
  group_by(job_title) %>%
  summarise(
    mean_salary = mean(salary_in_usd),
    median_salary = median(salary_in_usd),
    min_salary = min(salary_in_usd),
    max_salary = max(salary_in_usd),
    Q1 = quantile(salary_in_usd, probs = 0.25),
    Q3 = quantile(salary_in_usd, probs = 0.75)
  )
residence_summary <- salaries %>%
  group_by(employee_residence) %>%
  summarise(
    mean_salary = mean(salary_in_usd),
    median_salary = median(salary_in_usd),
    min_salary = min(salary_in_usd),
    max_salary = max(salary_in_usd),
    Q1 = quantile(salary_in_usd, probs = 0.25, na.rm = TRUE),
    Q3 = quantile(salary_in_usd, probs = 0.75, na.rm = TRUE)
  )
location_summary <- salaries %>%
  group_by(company_location) %>%
  summarise(
    mean_salary = mean(salary_in_usd),
    median_salary = median(salary_in_usd),
    min_salary = min(salary_in_usd),
    max_salary = max(salary_in_usd),
    Q1 = quantile(salary_in_usd, probs = 0.25, na.rm = TRUE),
    Q3 = quantile(salary_in_usd, probs = 0.75, na.rm = TRUE)
  )
head(title_summary)
head(residence_summary)
head(location_summary)
```
## Part 2: Problem formulation and preparation for statistical learning algorithms
